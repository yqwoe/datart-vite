import{h as o,u as y,j as s,L as T,w as E,g9 as w,dY as M,fH as _,dp as V,fh as z,fn as W,g as D,J as R}from"./entryPointFactory.769a35d1.js";import{gh as O,eV as k,dK as A,gE as F,eU as H,eT as $,gB as G,gG as K,dp as q,p as B}from"./index.1ca238f3.js";import{aL as J,c9 as Q,ca as U,cb as Y,bT as Z,b_ as X,cc as ee,c8 as ae,aM as te}from"./WidgetMapper.1c4fa18b.js";import{u as L,S as se,P as ne}from"./useRouteQuery.20bf18f6.js";import{N as oe,K as ie,ar as re,u as ce}from"./index.e6917ec6.js";import{l as le,d as de,f as ue}from"./selectors.caa0f834.js";import{_ as fe,R as pe}from"./plugin.22835875.js";import{u as N}from"./index.3e5f4c4f.js";import"./LoginForm.f01daba0.js";import"./AuthLayout.7c6c8571.js";import"./GithubOutlined.a187f62f.js";const ge=o.memo(({boardId:e})=>{var f;const a=y(l=>O()(l,e));if(!a)return s.jsxs("div",{children:["loading ",s.jsx(T,{})]});const r=(f=a==null?void 0:a.config)==null?void 0:f.type;return s.jsx(J,{board:a,editing:!1,autoFit:!1,renderMode:"share",children:s.jsxs(me,{children:[r==="auto"&&s.jsx(Q,{boardId:a.id}),r==="free"&&s.jsx(U,{boardId:a.id}),s.jsx(Y,{})]})})}),me=E.div.withConfig({displayName:"BoardPageItem__Wrapper",componentId:"sc-k08ajt-0"})(["position:fixed;top:0;right:0;bottom:0;left:0;z-index:",";display:flex;flex-direction:column;padding-bottom:0;background-color:",";"],w,e=>e.theme.bodyBackground),he=({page:e})=>{const{relId:a,relType:r}=e,f=o.useMemo(()=>r==="DASHBOARD"?s.jsx(ge,{boardId:a}):null,[a,r]),{in:l,out:n,speed:x}=e.config.transitionEffect;return s.jsx(xe,{className:"story-page","data-transition":`${l} ${n}`,"data-transition-speed":x,children:f})},xe=E.section.withConfig({displayName:"StoryPageItem__SectionWrap",componentId:"sc-1g54ixv-0"})(["display:flex !important;flex:1;flex-direction:column;width:100% !important;height:100% !important;padding:0 !important;"]),{Content:Se}=A,Pe=o.memo(({storyBoard:e,shareToken:a})=>{var j,m,b,i;const{id:r}=e,f=o.useMemo(()=>M(),[]),l=o.useRef(),n=N(),[x,S]=o.useState(0),c=o.useRef(null),I=y(t=>Z(t,r)),g=y(le),d=o.useMemo(()=>Object.values(I).sort((u,p)=>u.config.index-p.config.index),[I]),P=o.useCallback(t=>{const{indexh:u}=t;S(u);const p=d[u].id;n(k.changePageSelected({storyId:r,pageId:p,multiple:!1}))},[n,d,r]);o.useEffect(()=>{if(d.length===0)return;const t=d[0].id;n(k.changePageSelected({storyId:r,pageId:t,multiple:!1}))},[n,d,r]);const h=o.useMemo(()=>{var t,u,p,v;return(u=(t=e==null?void 0:e.config)==null?void 0:t.autoPlay)!=null&&u.auto?((v=(p=e==null?void 0:e.config)==null?void 0:p.autoPlay)==null?void 0:v.delay)*1e3:null},[(m=(j=e==null?void 0:e.config)==null?void 0:j.autoPlay)==null?void 0:m.auto,(i=(b=e==null?void 0:e.config)==null?void 0:b.autoPlay)==null?void 0:i.delay]);return o.useEffect(()=>{var t;if(d.length>0)return l.current=new fe(document.getElementById(f),{hash:!1,history:!1,controls:!0,controlsLayout:"none",slideNumber:"c/t",controlsTutorial:!1,progress:!1,loop:!0,width:"100%",height:"100%",margin:0,minScale:1,maxScale:1,autoSlide:h,transition:"convex",transitionSpeed:"slow",viewDistance:100,plugins:[pe],keyboard:{27:()=>{}}}),(t=l.current)==null||t.initialize(),l.current&&l.current.addEventListener("slidechanged",P),()=>{l.current.removeEventListener("slidechanged",P)}},[f,P,d.length,h,n]),o.useEffect(()=>{const t=d[x];if(!t||!t.relId||!t.relType)return;const{relId:u,relType:p,id:v}=t,C=g==null?void 0:g[v];C&&n(X({shareToken:a,relId:u,relType:p,vizToken:C}))},[x,n,d,I,g,a]),s.jsx(oe,{backend:ie,children:s.jsx(ve,{ref:c,children:s.jsx(Se,{children:s.jsx("div",{id:f,className:"reveal",children:s.jsx("div",{className:"slides",children:d.map(t=>s.jsx(he,{page:t},t.id))})})})})})}),ve=E.div.withConfig({displayName:"StoryPlayerForShare__Wrapper",componentId:"sc-11qpnux-0"})(["position:fixed;top:0;right:0;bottom:0;left:0;z-index:",";display:flex;flex-direction:column;background-color:",";.tool-bar{height:100px;}& .reveal .slides{text-align:left;}"],_,V);function _e(){const{shareActions:e}=F();H(),$(),re();const a=N(),r=z(),f=W(),l=r.search,n=f.token,x=!!D(),S=y(de),c=y(ee),I=y(ue),g=L({key:"type"}),P=L({key:"eager"})?"schedule":"share";o.useEffect(()=>{c!=null&&c.name&&a(G.savePageTitle({title:c==null?void 0:c.name}))},[c==null?void 0:c.name,a]);const h=o.useMemo(()=>ae.toParams(l),[l]),j=()=>{if(g==="CODE"){const i=B.session.get(n);i?m(n,i,h):a(e.saveNeedVerify(!0))}else g==="LOGIN"&&!x?a(e.saveNeedVerify(!0)):m(n,void 0,h)};ce(()=>{q.instance().load().then(()=>j()).catch(i=>{})});const m=o.useCallback((i,t,u,p,v,C)=>{a(K({shareToken:i,sharePassword:t,filterSearchParams:u,renderMode:P,userName:p,passWord:v,authorizedToken:C}))},[a,P]),b=o.useCallback(i=>{a(R({params:i,resolve:()=>{m(n,void 0,h,i.username,i.password)}}))},[a,m,h,n]);return s.jsxs(ye,{className:"datart-viz",children:[s.jsx(se,{visible:!!S&&g==="LOGIN",onChange:b}),s.jsx(ne,{visible:!!S&&g==="CODE",onChange:i=>{m(n,i)}}),!I&&!S&&s.jsx("div",{className:"loading-container",children:s.jsx(te,{})}),!S&&c&&s.jsx(Pe,{storyBoard:c,shareToken:n})]})}const ye=E.div.withConfig({displayName:"ShareStoryPlayerPage__StyledWrapper",componentId:"sc-7n3dm4-0"})(["width:100%;height:100vh;.loading-container{display:flex;height:100vh;}"]);export{_e as default};

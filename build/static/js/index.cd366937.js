import{t as k,w as y,y as T,h as s,e as h,j as e,q as v,m as $,z as _,A as z}from"./entryPointFactory.769a35d1.js";import{L as B}from"./index.e6917ec6.js";import{F as M}from"./AuthLayout.7c6c8571.js";import{B as F,F as d,I as g,R}from"./index.1ca238f3.js";import{g as U,a as A}from"./validators.78252eaf.js";import"./index.3e5f4c4f.js";var u=(r=>(r.Email="EMAIL",r.UserName="USERNAME",r))(u||{});const G=async r=>{const{data:n}=await k({url:"/users/forget/password",method:"POST",params:r});return n},O=async r=>{const{data:n}=await k({url:"/users/reset/password",method:"PUT",data:r});return n},V=({onNextStep:r})=>{const[n]=d.useForm(),[c,p]=s.useState(u.Email),[i,o]=s.useState(),[a,w]=s.useState(""),[m,x]=s.useState(!1),t=h("forgotPassword"),f=h("global"),b=s.useMemo(()=>({type:u.Email}),[]),I=s.useCallback(l=>{x(!0),G(l).then(j=>{o(j),w(l==null?void 0:l.principal)}).finally(()=>{x(!1)})},[]),C=s.useMemo(()=>c===u.Email,[c]),N=s.useCallback(l=>{const j=l.target.value;p(j),n.setFieldsValue({principal:void 0}),w(""),o("")},[n]),q=s.useMemo(()=>Object.values(u).map(l=>({label:t(l.toLowerCase()),value:l})),[t]),E=s.useMemo(()=>C?e.jsx(d.Item,{name:"principal",rules:[{required:!0,message:`${t("email")}${f("validation.required")}`},{type:"email",message:t("emailInvalid")}],children:e.jsx(g,{size:"large",placeholder:t("enterEmail")})}):e.jsx(d.Item,{name:"principal",rules:[{required:!0,message:`${t("username")}${f("validation.required")}`}],children:e.jsx(g,{size:"large",placeholder:t("enterUsername")})}),[C,t,f]),S=s.useCallback(()=>{r(i)},[r,i]),L=s.useMemo(()=>i&&i.length?e.jsxs(H,{children:[t("desc1"),c===u.UserName?e.jsxs(e.Fragment,{children:[e.jsx("b",{children:a}),e.jsx("span",{children:t("desc2")})]}):e.jsx("b",{children:a}),t("desc3")]}):e.jsx(e.Fragment,{}),[a,c,i,t]);return e.jsxs(d,{initialValues:b,onFinish:I,form:n,children:[e.jsx(d.Item,{name:"type",children:e.jsx(R.Group,{size:"large",options:q,onChange:N})}),E,e.jsx(d.Item,{className:"last",children:i?e.jsxs(e.Fragment,{children:[L,e.jsx(P,{type:"primary",onClick:S,size:"large",children:t("nextStep")})]}):e.jsx(P,{loading:m,type:"primary",htmlType:"submit",size:"large",children:t("send")})})]})},P=y(F).withConfig({displayName:"CheckCodeForm__BigButton",componentId:"sc-g0zq0e-0"})(["width:100%;"]),H=y.div.withConfig({displayName:"CheckCodeForm__TipsWrapper",componentId:"sc-g0zq0e-1"})(["margin-bottom:",";"],T),W=({token:r})=>{const[n]=d.useForm(),c=v(),[p,i]=s.useState(!1),o=h("forgotPassword"),a=h("global"),w=s.useCallback(m=>{i(!0);const x={newPassword:m==null?void 0:m.newPassword,token:r,verifyCode:m==null?void 0:m.verifyCode};O(x).then(t=>{t&&($.success(o("resetSuccess")),c("/login"))}).finally(()=>{i(!1)})},[r,c,o]);return e.jsxs(d,{form:n,onFinish:w,size:"large",children:[e.jsx(d.Item,{name:"newPassword",rules:[{required:!0,message:`${o("password")}${a("validation.required")}`},{validator:U(a("validation.invalidPassword"))}],children:e.jsx(g.Password,{placeholder:o("enterNewPassword")})}),e.jsx(d.Item,{name:"confirmPassword",rules:[{required:!0,message:`${o("password")}${a("validation.required")}`},A("newPassword",a("validation.invalidPassword"),a("validation.passwordNotMatch"))],children:e.jsx(g.Password,{placeholder:o("confirmNewPassword")})}),e.jsx(d.Item,{name:"verifyCode",rules:[{required:!0,message:`${o("verifyCode")}${a("validation.required")}`}],children:e.jsx(g,{placeholder:o("verifyCode")})}),e.jsx(F,{htmlType:"submit",loading:p,type:"primary",block:!0,children:o("reset")})]})};function D(){const[r,n]=s.useState(!0),[c,p]=s.useState(""),i=h("forgotPassword"),o=s.useCallback(a=>{n(!1),p(a)},[]);return e.jsxs(M,{children:[r?e.jsx(V,{onNextStep:o}):e.jsx(W,{token:c}),e.jsx(J,{to:"/login",children:i("return")})]})}const J=y(_).withConfig({displayName:"ForgetPasswordForm__LinkButton",componentId:"sc-1k5kkoo-0"})(["display:block;line-height:",";"],z);function se(){return e.jsx(B,{children:e.jsx(D,{})})}export{se as ForgetPasswordPage};
